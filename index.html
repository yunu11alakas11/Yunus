<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idiom Master: Glow & Chaos Edition</title>
    <style>
        :root {
            --bg: #ffffff; --card-bg: #f8f9fa; --text: #333; --border: #ddd; --accent: #2196F3;
            --easy: #4CAF50; --hard: #FF9800; --multi: #f44336; --impossible: #000000;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; transition: 0.3s; overflow-x: hidden; }
        .game-card { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; max-width: 850px; width: 100%; position: relative; }
        
        /* Ekran Sallanma (Multi & Impossible i√ßin) */
        @keyframes screenShake { 
            0%, 100% { transform: translate(0, 0); } 
            10% { transform: translate(-8px, -8px); } 
            30% { transform: translate(8px, 8px); } 
            50% { transform: translate(-8px, 8px); } 
            70% { transform: translate(8px, -8px); } 
        }
        .shake-screen { animation: screenShake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        
        /* Parlama Efektleri */
        @keyframes glowText {
            0% { text-shadow: 0 0 5px #e91e63, 0 0 10px #e91e63; transform: scale(1); }
            50% { text-shadow: 0 0 20px #e91e63, 0 0 30px #e91e63; transform: scale(1.1); }
            100% { text-shadow: 0 0 5px #e91e63, 0 0 10px #e91e63; transform: scale(1); }
        }
        .combo-active { animation: glowText 0.5s ease-in-out infinite; color: #e91e63; }

        @keyframes scorePulse {
            0% { transform: scale(1); color: var(--text); }
            50% { transform: scale(1.2); color: var(--easy); text-shadow: 0 0 10px var(--easy); }
            100% { transform: scale(1); color: var(--text); }
        }
        .pulse { animation: scorePulse 0.4s ease-out; }

        @keyframes impossibleVibrate { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, -1px); } }

        .btn-easy { border: 2px solid var(--easy) !important; color: var(--easy); }
        .btn-hard { border: 2px solid var(--hard) !important; color: var(--hard); }
        .btn-multi { border: 2px solid var(--multi) !important; color: var(--multi); }
        .btn-impossible { background: #000 !important; color: #ff0000 !important; border: 2px solid #ff0000 !important; animation: impossibleVibrate 0.1s infinite; font-weight: 900 !important; }

        .btn { flex-grow: 1; padding: 12px; border: 2px solid var(--border); border-radius: 10px; background: transparent; color: var(--text); cursor: pointer; font-weight: bold; transition: 0.2s; }
        .speaker-btn { padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: white; cursor: pointer; font-size: 1.2em; }
        .timer-bar { width: 100%; height: 15px; background: #eee; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        #timer-fill { width: 100%; height: 100%; background: var(--accent); transition: width 0.1s linear; }
        .quiz-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .column { display: flex; flex-direction: column; gap: 10px; }
        .selected { border-color: var(--accent) !important; background: rgba(33, 150, 243, 0.1) !important; }
        .correct { background-color: var(--easy) !important; color: white !important; }
        .wrong { background-color: var(--multi) !important; color: white !important; }
        #combo-text { font-size: 1.8em; font-weight: 900; min-height: 1.6em; }
        #action-btn, #menu-btn, #party-btn { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 10px; cursor:pointer; font-weight: bold; margin-top: 15px; width: 100%; font-size: 1.1em; }
        #party-btn { background: linear-gradient(45deg, #f44336, #9c27b0); display: none; }
        #canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="game-card" id="main-card">
    <div id="menu">
        <h1>IDIOM MASTER</h1>
        <p>5 Rounds of Dynamic Challenges!</p>
        <div style="display:flex; flex-direction:column; gap:12px;">
            <button class="btn btn-easy" onclick="startGame('easy')">EASY MODE</button>
            <button class="btn btn-hard" onclick="startGame('hard')">HARD MODE</button>
            <button class="btn btn-multi" onclick="startGame('multi')">MULTI HARD MODE</button>
            <button class="btn btn-impossible" onclick="startGame('impossible')">IMPOSSIBLE MODE</button>
        </div>
    </div>
    <div id="game" style="display:none;">
        <div style="display:flex; justify-content: space-between; font-weight: bold; font-size: 1.2em;">
            <span id="round-display">Round: 1/5</span>
            <span id="score-display">Score: 0</span>
        </div>
        <div id="combo-text"></div>
        <div id="timer-ui"><div class="timer-bar"><div id="timer-fill"></div></div><div id="time-text">Time: --</div></div>
        <hr><div id="game-area"></div>
        <button id="action-btn" style="display:none;" onclick="initLightningQuiz()">Lightning Quiz! ‚ö°</button>
        <button id="party-btn" onclick="celebrate()">‚ú® START PARTY MODE ‚ú®</button>
        <button id="menu-btn" style="display:none; background:#555;" onclick="location.reload()">Back to Menu</button>
    </div>
</div>

<script>
    const pools = {
        easy: [
            {en: "Piece of cake", tr: "√áocuk oyuncaƒüƒ±"}, {en: "Time flies", tr: "Zaman u√ßar"}, {en: "Break a leg", tr: "ƒ∞yi ≈üanslar"},
            {en: "Hold on", tr: "Bekle"}, {en: "Clean up", tr: "Temizle"}, {en: "Good job", tr: "ƒ∞yi i≈ü"},
            {en: "Keep it up", tr: "Aynen devam"}, {en: "Slow down", tr: "Yava≈üla"}, {en: "Hurry up", tr: "Acele et"},
            {en: "Be careful", tr: "Dikkatli ol"}, {en: "Shut up", tr: "Sus"}, {en: "Calm down", tr: "Sakin ol"},
            {en: "Don't worry", tr: "Endi≈üelenme"}, {en: "Look out", tr: "Dikkat et"}, {en: "I agree", tr: "Aynƒ± fikirdeyim"}
        ],
        hard: [
            {en: "Under the weather", tr: "Halsiz"}, {en: "Bite the bullet", tr: "Di≈üini sƒ±kmak"}, {en: "Call it a day", tr: "Paydos etmek"},
            {en: "Hit the sack", tr: "Yatƒ±p uyumak"}, {en: "Once in a blue moon", tr: "Kƒ±rk yƒ±lda bir"}, {en: "Spill the beans", tr: "Sƒ±rrƒ± if≈üa etmek"},
            {en: "Cold feet", tr: "G√∂z√º korkmak"}, {en: "Costs an arm and a leg", tr: "√áok pahalƒ±"}, {en: "Cutting corners", tr: "ƒ∞≈üi ucuza getirmek"},
            {en: "Let the cat out", tr: "Baklayƒ± aƒüzƒ±ndan √ßƒ±karmak"}, {en: "Better late than never", tr: "Ge√ß olsun g√º√ß olmasƒ±n"},
            {en: "Easy does it", tr: "Acele etmeden yap"}, {en: "Get out of hand", tr: "Kontrolden √ßƒ±kmak"},
            {en: "Hang in there", tr: "Dayan, vazge√ßme"}, {en: "On the ball", tr: "ƒ∞≈üini iyi bilmek"}
        ],
        impossible: [
            {en: "Beat around the bush", tr: "Lafƒ± dolandƒ±rmak"}, {en: "Barking up the wrong tree", tr: "Yanlƒ±≈ü kapƒ±yƒ± √ßalmak"},
            {en: "Burn the midnight oil", tr: "Gece g√ºnd√ºz √ßalƒ±≈ümak"}, {en: "Cry over spilt milk", tr: "Bo≈üuna √ºz√ºlmek"},
            {en: "Jump on the bandwagon", tr: "Akƒ±ma kapƒ±lmak"}, {en: "A blessing in disguise", tr: "Her ≈üer de bir hayƒ±r"},
            {en: "Curiosity killed the cat", tr: "Fazla merak iyi deƒüildir"}, {en: "Kill two birds with one stone", tr: "Bir ta≈üla iki ku≈ü"},
            {en: "Penny for your thoughts", tr: "Ne d√º≈ü√ºn√ºyorsun?"}, {en: "The best of both worlds", tr: "Her iki durumun da avantajƒ±"},
            {en: "Through thick and thin", tr: "ƒ∞yi g√ºnde k√∂t√º g√ºnde"}, {en: "Wrap your head around", tr: "Kavramaya √ßalƒ±≈ümak"},
            {en: "Your guess is as good as mine", tr: "Ben de senin kadar biliyorum"}, {en: "Speak of the devil", tr: "ƒ∞yi insan lafƒ±n √ºst√ºne"},
            {en: "See eye to eye", tr: "Aynƒ± fikirde olmak"}
        ]
    };

    let score = 0, timeLeft = 0, initialTime = 0, timerInterval, round = 1, matchesFound = 0, targetMatches = 0, currentDiff = '', combo = 0, selectedEng = null, selectedTr = null;
    let currentSessionPool = [];
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(freq, type = 'sine') {
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination); osc.type = type; osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4); osc.stop(audioCtx.currentTime + 0.4);
    }

    function startGame(diff) {
        currentDiff = diff;
        const basePool = diff === 'easy' ? pools.easy : (diff === 'hard' || diff === 'multi' ? pools.hard : pools.impossible);
        currentSessionPool = [...basePool].sort(() => Math.random() - 0.5);
        document.getElementById('menu').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        resetRound(true);
    }

    function resetRound(firstStart = false) {
        matchesFound = 0; selectedEng = null; selectedTr = null;
        document.getElementById('action-btn').style.display = 'none';
        document.getElementById('round-display').innerText = `Round: ${round}/5`;
        targetMatches = currentDiff === 'easy' ? 3 : (currentDiff === 'hard' ? 3 : (currentDiff === 'multi' ? 4 : 5));
        if(currentDiff !== 'easy') {
            initialTime = currentDiff === 'hard' ? 35 : (currentDiff === 'multi' ? 25 : 15);
            timeLeft = initialTime; if(firstStart) startTimer();
        } else { document.getElementById('timer-ui').style.display = 'none'; }
        initMatchStage();
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            document.getElementById('timer-fill').style.width = (timeLeft/initialTime*100) + "%";
            document.getElementById('time-text').innerText = `Time: ${Math.ceil(timeLeft)}s`;
            if(timeLeft <= 0) { clearInterval(timerInterval); alert("GAME OVER!"); location.reload(); }
        }, 100);
    }

    function initMatchStage() {
        const area = document.getElementById('game-area'); area.innerHTML = '<h3>Match the Idioms</h3>';
        const cont = document.createElement('div'); cont.className = 'quiz-container';
        const col1 = document.createElement('div'); const col2 = document.createElement('div');
        col1.className = 'column'; col2.className = 'column';
        
        let roundIdioms = currentSessionPool.splice(0, targetMatches);
        
        roundIdioms.forEach(item => {
            const row = document.createElement('div'); row.className = 'btn-row';
            const s = document.createElement('button'); s.className = 'speaker-btn'; s.innerHTML = 'üîä';
            const b = document.createElement('button'); b.className = 'btn btn-' + currentDiff; b.innerText = item.en;
            s.onclick = () => { const u = new SpeechSynthesisUtterance(item.en); u.lang = 'en-US'; speechSynthesis.speak(u); };
            b.onclick = () => { if(selectedEng) selectedEng.classList.remove('selected'); selectedEng = b; b.classList.add('selected'); checkMatch(); };
            row.append(s, b); col1.appendChild(row);
        });

        [...roundIdioms].sort(() => Math.random() - 0.5).forEach(item => {
            const b = document.createElement('button'); b.className = 'btn btn-' + currentDiff; b.innerText = item.tr;
            b.onclick = () => { if(selectedTr) selectedTr.classList.remove('selected'); selectedTr = b; b.classList.add('selected'); checkMatch(); };
            col2.appendChild(b);
        });
        cont.append(col1, col2); area.appendChild(cont);
    }

    function checkMatch() {
        if(selectedEng && selectedTr) {
            const allIdioms = pools.easy.concat(pools.hard, pools.impossible);
            const match = allIdioms.find(i => i.en === selectedEng.innerText && i.tr === selectedTr.innerText);
            if(match) {
                combo++; 
                score += (20 * combo); 
                playSound(880 + (combo * 50));
                
                // Puan Parlama Efekti
                const scoreDisplay = document.getElementById('score-display');
                scoreDisplay.classList.remove('pulse'); void scoreDisplay.offsetWidth; scoreDisplay.classList.add('pulse');
                
                selectedEng.className = 'btn correct'; selectedTr.className = 'btn correct';
                
                if(combo >= 2) {
                    const comboText = document.getElementById('combo-text');
                    comboText.innerText = "COMBO x" + combo;
                    comboText.className = "combo-active";
                }
                
                matchesFound++; selectedEng = null; selectedTr = null;
                if(matchesFound === targetMatches) document.getElementById('action-btn').style.display = 'block';
            } else {
                handleError();
                selectedEng.className = 'btn wrong'; selectedTr.className = 'btn wrong';
                setTimeout(() => { if(selectedEng) selectedEng.className = 'btn btn-' + currentDiff; if(selectedTr) selectedTr.className = 'btn btn-' + currentDiff; selectedEng = null; selectedTr = null; }, 500);
            }
            document.getElementById('score-display').innerText = `Score: ${score}`;
        }
    }

    function handleError() {
        combo = 0; 
        document.getElementById('combo-text').innerText = ""; 
        document.getElementById('combo-text').className = "";
        playSound(120, 'square');
        if(currentDiff === 'multi' || currentDiff === 'impossible') {
            const card = document.getElementById('main-card');
            card.classList.add('shake-screen');
            setTimeout(() => card.classList.remove('shake-screen'), 400);
        }
        score = Math.max(0, score - 15); timeLeft -= 3;
    }

    function initLightningQuiz() {
        document.getElementById('action-btn').style.display = 'none';
        document.getElementById('timer-ui').style.display = 'block';
        initialTime = 5; timeLeft = 5; startTimer();
        const area = document.getElementById('game-area');
        const allPool = pools.easy.concat(pools.hard, pools.impossible);
        const correct = allPool[Math.floor(Math.random() * allPool.length)];
        area.innerHTML = `<h3 style="color:#FFD700; text-shadow:0 0 10px #FFD700;">FLASH QUIZ! "${correct.en}"?</h3>`;
        let opts = [correct.tr]; while(opts.length < 4) { let r = allPool[Math.floor(Math.random() * allPool.length)].tr; if(!opts.includes(r)) opts.push(r); }
        opts.sort(() => Math.random() - 0.5).forEach(opt => {
            const b = document.createElement('button'); b.className = 'btn btn-' + currentDiff; b.style.display = "block"; b.style.width="100%"; b.style.margin="8px 0"; b.innerText = opt;
            b.onclick = () => {
                clearInterval(timerInterval);
                if(opt === correct.tr) { playSound(1000); score += 50; if(round < 5) { round++; resetRound(); } else { finishGame(); } }
                else { handleError(); finishGame(); }
            };
            area.appendChild(b);
        });
    }

    function finishGame() {
        clearInterval(timerInterval); 
        document.getElementById('combo-text').innerText = "";
        document.getElementById('game-area').innerHTML = `<h2>TOTAL SCORE: ${score}</h2>`;
        if(score >= 400) document.getElementById('party-btn').style.display = 'block';
        document.getElementById('menu-btn').style.display = 'block';
    }

    function celebrate() {
        const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let p = Array.from({length: 150}, () => ({ x: Math.random()*canvas.width, y: canvas.height, c: `hsl(${Math.random()*360},100%,50%)`, v: Math.random()*7+3 }));
        function anim() { ctx.clearRect(0,0,canvas.width,canvas.height); p.forEach(i => { i.y -= i.v; ctx.fillStyle = i.c; ctx.fillRect(i.x, i.y, 6, 6); }); requestAnimationFrame(anim); }
        anim(); playSound(600);
    }
</script>
</body>
</html>